import{HtmlUtils as e,Hooks as r}from"@delpi/common";import t,{useState as n,useEffect as l,useRef as o}from"react";import c from"perfect-scrollbar";var i={"ps-scroll-y":"onScrollY","ps-scroll-x":"onScrollX","ps-scroll-up":"onScrollUp","ps-scroll-down":"onScrollDown","ps-scroll-left":"onScrollLeft","ps-scroll-right":"onScrollRight","ps-y-reach-start":"onYReachStart","ps-y-reach-end":"onYReachEnd","ps-x-reach-start":"onXReachStart","ps-x-reach-end":"onXReachEnd"},u=function(e){var r=e.height,t=e.maxHeight,n=e.width,l=e.maxWidth,o={};return(r||t)&&(o.height=r||void 0,o.maxHeight=t||void 0),n&&(o.width=n),l&&(o.maxWidth=l),o},s=function(e,r){if(r){var t={};return Object.keys(i).forEach((function(n){var l=e[i[n]];l&&(t[n]=function(e){return l(e)},r.addEventListener(n,t[n],!1))})),t}},a=function(e,r){Object.keys(e).forEach((function(t){return r.removeEventListener(t,e[t],!1)}))};function f(e){return void 0===e&&(e=[]),e.reduce((function(e,r){return e+r.clientHeight||0}),0)}var d=function(e,r,t){if(e.current&&t){var n=e.current.querySelector("table"),l=n?n.querySelector("tbody"):null;if(l)return Object.keys(r).forEach((function(e){l.style[e]=r[e]})),{table:n,el:null==n?void 0:n.querySelector("tbody")}}return{el:e.current}};function p(r,t,n){var l=(n||e.findFirstLevel(r,t)).filter((function(r){return e.isVisible(r)}));return l.length>0?l[l.length-1]:{}}function v(e,r){return e.length<=0?[]:Array.from(e).filter((function(e){return!r.includes(e)}))}var h=function(){return h=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var l in r=arguments[t])Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l]);return e},h.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var g=":scope>.ps__rail-x",m=":scope>.ps__rail-y",y="".concat(g,", ").concat(g,">.ps__thumb-x, ").concat(m,", ").concat(m,">.ps__thumb-y"),w=function(e){var r=n(!1),t=r[0],c=r[1],i=function(e){var r=o(null),t=n(!1),c=t[0],i=t[1];return l((function(){try{"IntersectionObserver"in window&&(r.current=new IntersectionObserver((function(e){var r=e[0];return i(r.isIntersecting)})))}catch(e){i(!0)}}),[]),l((function(){if(r.current&&e.current)return r.current.observe(e.current),function(){var e;null===(e=r.current)||void 0===e||e.disconnect()}}),[e]),c}(e);return l((function(){i&&c(!0)}),[i]),t},S=function(e,r,t){void 0===r&&(r=!1);var c=n({}),i=c[0],u=c[1],s=n(!1),f=s[0],d=s[1],p=o(),v=o([]);l((function(){h()}),[i]);var h=function(){e&&(v.current=Array.from(e.querySelectorAll(y)),r&&v.current.forEach((function(e){e.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault()}))})))};return{psElement:v.current,scrollbar:p,setPsEvent:u,triggerScrollbar:h,handleFocus:function(){if(!f&&p.current){d(!0);var e=p.current.element.classList;if(e.contains("ps--active-y")||e.contains("ps--active-x"))return;p.current.update()}},handleClose:function(){p.current&&(a(i,p.current.element),u({}),p.current.destroy(),t&&(t.current=null))}}},b=function(n){var i,a=o(null),g=o(null),m=S(n.forTableChildren?a.current:g.current,n.triggerScrollClick,n.refScroll),y=m.psElement,b=m.scrollbar,_=m.triggerScrollbar,T=m.setPsEvent,E=m.handleFocus,C=m.handleClose,H=r.useWindowSize(),P=w(g),x=u(n),L=(null===(i=n.options)||void 0===i?void 0:i.wheelPropagation)||n.wheelStop;l((function(){if(P&&g.current){var e=d(g,x,n.forTableChildren),r=e.table,t=e.el;r&&(r.classList.add("list-dk-scroll-view"),r.classList.add("perfect-table"),a.current=t,null==t||t.classList.add(n.always?"scroll-always":""),null==t||t.classList.add(n.wheelStop?"scroll-wheel-stop":""));var l=h({},n.options||{});return l.wheelPropagation=L,b.current=new c(t,l),T(s(n,t)),n.refScroll&&(n.refScroll.current=b.current),_(),setTimeout((function(){return b.current.update()}),320),function(){C()}}}),[P,g.current]),l((function(){R()}),[n.effectData,H]);var k=function(e){void 0===e&&(e=!0),b.current&&(e&&(b.current.element.scrollTop=0),b.current.update())},R=function(){if(b.current){var r=b.current.element,t=r,l=t.children,o=t.scrollTop,c=t.scrollHeight;if(t.clientHeight>=c||!l.length)k(!0);else{var i=v(l,y);if(i.length){var u=p(r,":not(.ps__rail-x):not(.ps__rail-y)",i);if(u){var s=3*(r.querySelectorAll("div.ps__rail-y").length-1);n.forTableChildren?setTimeout((function(){var t=p(r,"div.ps__rail-y").clientHeight,n=u.getBoundingClientRect().top-r.getBoundingClientRect().top;if(void 0!==t&&n+u.clientHeight<t){var l=(t<c?c:t)-f(i);if(l>0)return e.scrollTo(r,o-l,250),void setTimeout((function(){return k(!1)}),320)}else setTimeout((function(){return k(!1)}))}),s):setTimeout((function(){return k(!1)}),s)}}else k(!0)}}},j=h(h({},n.style),n.forTableChildren?{}:x),N=n.forTableChildren?void 0:e.joinClass("list-dk-scroll-view","perfect-list",n.className),O=n.forTableChildren?"scroll-content":e.joinClass("scroll-content",{"scroll-always":n.always},{"scroll-wheel-stop":L});return t.createElement("div",{id:n.id,className:N,style:j,onMouseEnter:E},t.createElement("div",{ref:g,className:O},n.children))};b.defaultProps={wheelStop:!0,style:{}};var _=function(n){var i,a=o(null),d=S(a.current,n.triggerScrollClick,n.refScroll),g=d.psElement,m=d.scrollbar,y=d.triggerScrollbar,b=d.setPsEvent,_=d.handleFocus,T=d.handleClose,E=r.useWindowSize(),C=w(a),H=u(n),P=(null===(i=n.options)||void 0===i?void 0:i.wheelPropagation)||n.wheelStop;l((function(){if(C&&a.current){var r=a.current.parentElement;r.classList.add(e.joinClass(["list-dk-scroll-view",n.className])),r.classList.add("perfect-table");var t=h({},n.options||{});return t.suppressScrollX=!0,t.wheelPropagation=P,m.current=new c(a.current,t),b(s(n,a.current)),n.refScroll&&(n.refScroll.current=m.current),y(),setTimeout((function(){return m.current.update()}),320),function(){T()}}}),[C,a.current]),l((function(){L()}),[n.effectData,E]);var x=function(e){void 0===e&&(e=!0),m.current&&(e&&(m.current.element.scrollTop=0),m.current.update())},L=function(){if(m.current){var r=m.current.element,t=r,n=t.children,l=t.scrollTop,o=t.scrollHeight;if(t.clientHeight>=o||!n.length)x(!0);else{var c=v(n,g);if(c.length){var i=p(r,":not(.ps__rail-x):not(.ps__rail-y)",c);if(i){var u=3*(r.querySelectorAll("div.ps__rail-y").length-1);setTimeout((function(){var t=p(r,"div.ps__rail-y").clientHeight,n=i.getBoundingClientRect().top-r.getBoundingClientRect().top;if(void 0!==t&&n+i.clientHeight<t){var u=(t<o?o:t)-f(c);if(u>0)return e.scrollTo(r,l-u,250),void setTimeout((function(){return x(!1)}),320)}else setTimeout((function(){return x(!1)}))}),u)}}else x(!0)}}};return t.createElement("tbody",{ref:a,id:n.id,style:h(h({},n.style),H),className:e.joinClass({"scroll-always":n.always},{"scroll-wheel-stop":P}),onMouseEnter:_},n.children)};_.defaultProps={wheelStop:!0,style:{}};var T=function(i){var a,d=n("".concat(i.tagName).toLowerCase())[0],g=o(null),m=S(g.current,i.triggerScrollClick,i.refScroll),y=m.psElement,b=m.scrollbar,_=m.triggerScrollbar,T=m.setPsEvent,E=m.handleFocus,C=m.handleClose,H=r.useWindowSize(),P=w(g),x=u(i),L=(null===(a=i.options)||void 0===a?void 0:a.wheelPropagation)||i.wheelStop;l((function(){if(P&&g.current){var e=h({},i.options||{});return e.wheelPropagation=L,b.current=new c(g.current,e),T(s(i,g.current)),i.refScroll&&(i.refScroll.current=b.current),_(),setTimeout((function(){return b.current.update()}),320),function(){C()}}}),[P,g.current]),l((function(){R()}),[i.effectData,H]);var k=function(e){void 0===e&&(e=!0),b.current&&(e&&(b.current.element.scrollTop=0),b.current.update())},R=function(){if(b.current){var r=b.current.element,t=r,n=t.children,l=t.scrollTop,o=t.scrollHeight;if(t.clientHeight>=o||!n.length)k(!0);else{var c=v(n,y);if(c.length){var i=p(r,":not(.ps__rail-x):not(.ps__rail-y)",c);if(i){var u=3*(r.querySelectorAll("div.ps__rail-y").length-1);setTimeout((function(){var t=p(r,"div.ps__rail-y").clientHeight,n=i.getBoundingClientRect().top-r.getBoundingClientRect().top;if(void 0!==t&&n+i.clientHeight<t){var u=(t<o?o:t)-f(c);if(u>0)return e.scrollTo(r,l-u,250),void setTimeout((function(){return k(!1)}),320)}else setTimeout((function(){return k(!1)}))}),u)}}else k(!0)}}};return t.createElement(d,{ref:g,id:i.id,style:h(h({},i.style),x),className:e.joinClass("list-dk-scroll-view","perfect-list",{"scroll-always":i.always},{"scroll-wheel-stop":L}),onMouseEnter:E},i.children)};T.defaultProps={tagName:"ul",wheelStop:!0,style:{}};export{b as Scrollbar,T as ScrollbarDataList,_ as ScrollbarTBody,u as appendDimension,s as appendEventListener,f as calculatorRealSize,a as clearEventListener,b as default,p as find1stLevel,d as findTargetTable,v as psHtmlListSize};
